;; gorilla-repl.fileformat = 1

;; **
;;; # Central limit theorem in action
;;; 
;;; Some rhubarby maths to give the idea of what can be done:
;;; 
;;; $$\sum_i u_i \overset{p}{\to} N $$
;;; 
;;; Start by loading the plot library.
;; **

;; @@
(use 'gorilla-plot.core)
;; @@
;; =>
;;; nil
;; <=

;; **
;;; And define a function for the normal distribution.
;; **

;; @@
(defn gaussian
  [x sigma mu]
  (* (/ 0.4 sigma) (Math/exp (- (/ (* (- x mu) (- x mu)) (* 2 (* sigma sigma)))))))
;; @@
;; =>
;;; #'user/gaussian
;; <=

;; **
;;; Now let's look at the sums of these uniformly distributed values and compare them to the appropriate normal distribution.
;; **

;; @@
(compose
  (histogram (repeatedly 10000 #(- (apply + (repeatedly 50 rand)) 25))
             :bins 100
             :normalise :probability-density)
  (plot #(gaussian % 2 0) [-10 10]))
;; @@
;; =>
;;; {:gorilla-repl.types/vega {"width" 400, "height" 247.2188, "padding" {"left" 50, "bottom" 20, "top" 10, "right" 10}, "scales" [{"name" "x", "type" "linear", "range" "width", "domain" {"data" "c1b99cc0-775f-4e81-97f9-04e94244e911", "field" "data.x"}} {"name" "y", "type" "linear", "range" "height", "nice" true, "domain" {"data" "c1b99cc0-775f-4e81-97f9-04e94244e911", "field" "data.y"}}], "axes" [{"scale" "x", "type" "x"} {"scale" "y", "type" "y"}], "data" ({"name" "c1b99cc0-775f-4e81-97f9-04e94244e911", "values" ({"x" -7.658785926006598, "y" 0} {"x" -7.491549732663073, "y" 5.979566862933037E-4} {"x" -7.324313539319549, "y" 0.0} {"x" -7.157077345976025, "y" 0.0} {"x" -6.989841152632501, "y" 5.979566862933037E-4} {"x" -6.822604959288976, "y" 5.979566862933037E-4} {"x" -6.655368765945452, "y" 0.0} {"x" -6.488132572601928, "y" 5.979566862933037E-4} {"x" -6.320896379258404, "y" 0.002391826745173215} {"x" -6.153660185914879, "y" 0.001793870058879911} {"x" -5.986423992571355, "y" 0.004185696804053126} {"x" -5.819187799227831, "y" 0.0029897834314665185} {"x" -5.651951605884307, "y" 0.004185696804053126} {"x" -5.484715412540782, "y" 0.0053816101766397334} {"x" -5.317479219197258, "y" 0.0053816101766397334} {"x" -5.150243025853734, "y" 0.007773436921812948} {"x" -4.98300683251021, "y" 0.00956730698069286} {"x" -4.8157706391666855, "y" 0.015546873843625896} {"x" -4.648534445823161, "y" 0.01734074390250581} {"x" -4.481298252479637, "y" 0.014948917157332592} {"x" -4.314062059136113, "y" 0.014948917157332592} {"x" -4.1468258657925885, "y" 0.022124397392852237} {"x" -3.9795896724490643, "y" 0.02750600756949197} {"x" -3.81235347910554, "y" 0.0322896610598384} {"x" -3.6451172857620158, "y" 0.03527944449130492} {"x" -3.4778810924184915, "y" 0.04185696804053126} {"x" -3.3106448990749673, "y" 0.049032448276050904} {"x" -3.143408705731443, "y" 0.05321814508010403} {"x" -2.976172512387919, "y" 0.0639813654333835} {"x" -2.8089363190443946, "y" 0.06816706223743663} {"x" -2.6417001257008703, "y" 0.08610576282623573} {"x" -2.474463932357346, "y" 0.0968689831795152} {"x" -2.307227739013822, "y" 0.10643629016020806} {"x" -2.1399915456702976, "y" 0.11839542388607413} {"x" -1.9727553523267733, "y" 0.13155047098452682} {"x" -1.805519158983249, "y" 0.12138520731754066} {"x" -1.6382829656397249, "y" 0.11660155382719423} {"x" -1.4710467722962006, "y" 0.1441075613966862} {"x" -1.3038105789526764, "y" 0.15307691169108575} {"x" -1.1365743856091521, "y" 0.15128304163220585} {"x" -0.9693381922656279, "y" 0.16742787216212504} {"x" -0.8021019989221037, "y" 0.18596452943721745} {"x" -0.6348658055785794, "y" 0.18656248612351076} {"x" -0.46762961223505517, "y" 0.19612979310420361} {"x" -0.30039341889153093, "y" 0.1919440963001505} {"x" -0.1331572255480067, "y" 0.20031548990825673} {"x" 0.0340789677955175, "y" 0.20509914339860316} {"x" 0.20131516113904172, "y" 0.18417065937833754} {"x" 0.36855135448256593, "y" 0.1775931358291112} {"x" 0.5357875478260902, "y" 0.18357270269204423} {"x" 0.7030237411696144, "y" 0.1805829192605777} {"x" 0.8702599345131387, "y" 0.1787890492016978} {"x" 1.0374961278566628, "y" 0.1787890492016978} {"x" 1.204732321200187, "y" 0.18716044280980407} {"x" 1.3719685145437113, "y" 0.15546873843625897} {"x" 1.5392047078872355, "y" 0.1584585218677255} {"x" 1.7064409012307598, "y" 0.1309525142982335} {"x" 1.873677094574284, "y" 0.1291586442393536} {"x" 2.040913287917808, "y" 0.12377703406271387} {"x" 2.2081494812613323, "y" 0.11899338057236744} {"x" 2.3753856746048565, "y" 0.0962710264932219} {"x" 2.5426218679483807, "y" 0.10583833347391476} {"x" 2.709858061291905, "y" 0.07474458578666296} {"x" 2.8770942546354292, "y" 0.07594049915924957} {"x" 3.0443304479789535, "y" 0.06637319217855671} {"x" 3.2115666413224777, "y" 0.05680588519786385} {"x" 3.378802834666002, "y" 0.050826318334930815} {"x" 3.546039028009526, "y" 0.05022836164863751} {"x" 3.7132752213530504, "y" 0.04544470815829108} {"x" 3.8805114146965747, "y" 0.03647535786389153} {"x" 4.0477476080400985, "y" 0.026310094196905363} {"x" 4.214983801383623, "y" 0.024516224138025452} {"x" 4.382219994727147, "y" 0.023918267451732148} {"x" 4.549456188070671, "y" 0.02272235407914554} {"x" 4.7166923814141954, "y" 0.012557090412159378} {"x" 4.88392857475772, "y" 0.010763220353279467} {"x" 5.051164768101244, "y" 0.008969350294399556} {"x" 5.218400961444768, "y" 0.007175480235519644} {"x" 5.385637154788292, "y" 0.006577523549226341} {"x" 5.552873348131817, "y" 0.005979566862933037} {"x" 5.720109541475341, "y" 0.0011959133725866075} {"x" 5.887345734818865, "y" 0.004185696804053126} {"x" 6.054581928162389, "y" 0.003587740117759822} {"x" 6.221818121505914, "y" 0.003587740117759822} {"x" 6.389054314849438, "y" 0.0011959133725866075} {"x" 6.556290508192962, "y" 0.002391826745173215} {"x" 6.723526701536486, "y" 0.001793870058879911} {"x" 6.890762894880011, "y" 0.0} {"x" 7.057999088223535, "y" 0.001793870058879911} {"x" 7.225235281567059, "y" 5.979566862933037E-4} {"x" 7.392471474910583, "y" 0.0011959133725866075} {"x" 7.559707668254108, "y" 0.0} {"x" 7.726943861597632, "y" 0.0} {"x" 7.894180054941156, "y" 0.0} {"x" 8.06141624828468, "y" 0.0} {"x" 8.228652441628203, "y" 0.0} {"x" 8.395888634971726, "y" 0.0} {"x" 8.56312482831525, "y" 0.0} {"x" 8.730361021658773, "y" 0.0} {"x" 8.897597215002296, "y" 0.0} {"x" 9.06483340834582, "y" 0.0} {"x" 9.232069601689343, "y" 5.979566862933037E-4} {"x" 9.399305795032866, "y" 0})} {"name" "6eda6a08-6b67-4f17-b24d-ad0d71ac1314", "values" ({"x" -10, "y" 7.453306344157342E-7} {"x" -9.799999997019768, "y" 1.2227136022020082E-6} {"x" -9.599999994039536, "y" 1.9859008895787535E-6} {"x" -9.399999991059303, "y" 3.1933568466554097E-6} {"x" -9.199999988079071, "y" 5.083869442630077E-6} {"x" -8.999999985098839, "y" 8.013059747248974E-6} {"x" -8.799999982118607, "y" 1.2504301246871565E-5} {"x" -8.599999979138374, "y" 1.9318683610927946E-5} {"x" -8.399999976158142, "y" 2.9549673525896843E-5} {"x" -8.19999997317791, "y" 4.474916120466938E-5} {"x" -7.999999970197678, "y" 6.709252957952864E-5} {"x" -7.799999967217445, "y" 9.959109066711276E-5} {"x" -7.599999964237213, "y" 1.463604937211866E-4} {"x" -7.399999961256981, "y" 2.129532625969202E-4} {"x" -7.199999958276749, "y" 3.0676215890329826E-4} {"x" -6.999999955296516, "y" 4.3749825786254407E-4} {"x" -6.799999952316284, "y" 6.177431317230414E-4} {"x" -6.599999949336052, "y" 8.635680737170301E-4} {"x" -6.39999994635582, "y" 0.0011952046815864247} {"x" -6.1999999433755875, "y" 0.0016377403466157404} {"x" -5.999999940395355, "y" 0.002221799506292808} {"x" -5.799999937415123, "y" 0.002984157484620092} {"x" -5.599999934434891, "y" 0.003968219313121465} {"x" -5.3999999314546585, "y" 0.005224282454218924} {"x" -5.199999928474426, "y" 0.006809491580088464} {"x" -4.999999925494194, "y" 0.008787387543070678} {"x" -4.799999922513962, "y" 0.011226953610745277} {"x" -4.5999999195337296, "y" 0.014201072062040727} {"x" -4.399999916553497, "y" 0.017784325124320887} {"x" -4.199999913573265, "y" 0.022050107061901632} {"x" -3.999999910593033, "y" 0.027067059067306068} {"x" -3.7999999076128006, "y" 0.032894894202544614} {"x" -3.5999999046325684, "y" 0.03957974321387936} {"x" -3.399999901652336, "y" 0.04714921925263572} {"x" -3.199999898672104, "y" 0.0556074645983085} {"x" -2.9999998956918716, "y" 0.06493049855125375} {"x" -2.7999998927116394, "y" 0.07506222540759178} {"x" -2.599999889731407, "y" 0.08591147779981703} {"x" -2.399999886751175, "y" 0.09735045780688895} {"x" -2.1999998837709427, "y" 0.10921489230961066} {"x" -1.9999998807907104, "y" 0.12130613917293559} {"x" -1.7999998778104782, "y" 0.13339536950647682} {"x" -1.599999874830246, "y" 0.1452298146860898} {"x" -1.3999998718500137, "y" 0.1565409146696238} {"x" -1.1999998688697815, "y" 0.1670540488540041} {"x" -0.9999998658895493, "y" 0.17649938643452168} {"x" -0.799999862909317, "y" 0.18462327433935283} {"x" -0.5999998599290848, "y" 0.1911995003838428} {"x" -0.39999985694885254, "y" 0.19603973746572148} {"x" -0.1999998539686203, "y" 0.19900249729156638} {"x" 1.4901161193847656E-7, "y" 0.19999999999999946} {"x" 0.20000015199184418, "y" 0.1990024943261981} {"x" 0.4000001549720764, "y" 0.19603973162328203} {"x" 0.6000001579523087, "y" 0.19119949183655915} {"x" 0.8000001609325409, "y" 0.1846232633349483} {"x" 1.0000001639127731, "y" 0.1764993732842929} {"x" 1.2000001668930054, "y" 0.1670540339182087} {"x" 1.4000001698732376, "y" 0.15654089834113458} {"x" 1.6000001728534698, "y" 0.14522979737334754} {"x" 1.800000175833702, "y" 0.1333953516167646} {"x" 2.0000001788139343, "y" 0.12130612109691333} {"x" 2.2000001817941666, "y" 0.109214874407896} {"x" 2.400000184774399, "y" 0.09735044039927186} {"x" 2.600000187754631, "y" 0.08591146115746827} {"x" 2.8000001907348633, "y" 0.07506220974839269} {"x" 3.0000001937150955, "y" 0.06493048403815777} {"x" 3.2000001966953278, "y" 0.055607451340457185} {"x" 3.40000019967556, "y" 0.04714920730880908} {"x" 3.6000002026557922, "y" 0.03957973259776622} {"x" 3.8000002056360245, "y" 0.03289488488927549} {"x" 4.000000208616257, "y" 0.02706705100069495} {"x" 4.200000211596489, "y" 0.02205010016188641} {"x" 4.400000214576721, "y" 0.017784319294165653} {"x" 4.600000217556953, "y" 0.014201067194954814} {"x" 4.800000220537186, "y" 0.011226949595674444} {"x" 5.000000223517418, "y" 0.008787384269514283} {"x" 5.20000022649765, "y" 0.006809488941886312} {"x" 5.400000229477882, "y" 0.0052242803523266925} {"x" 5.600000232458115, "y" 0.003968217657451668} {"x" 5.800000235438347, "y" 0.002984156195065413} {"x" 6.000000238418579, "y" 0.0022217985130712366} {"x" 6.200000241398811, "y" 0.001637739590084685} {"x" 6.400000244379044, "y" 0.0011952041116685484} {"x" 6.600000247359276, "y" 8.635676490676143E-4} {"x" 6.800000250339508, "y" 6.177428187500568E-4} {"x" 7.00000025331974, "y" 4.3749802968947785E-4} {"x" 7.2000002562999725, "y" 3.0676199434329435E-4} {"x" 7.400000259280205, "y" 2.1295314518666783E-4} {"x" 7.600000262260437, "y" 1.46360410845439E-4} {"x" 7.800000265240669, "y" 9.959103279023577E-5} {"x" 8.000000268220901, "y" 6.709248958927605E-5} {"x" 8.200000271201134, "y" 4.47491338652843E-5} {"x" 8.400000274181366, "y" 2.9549655032275533E-5} {"x" 8.600000277161598, "y" 1.9318671232486508E-5} {"x" 8.80000028014183, "y" 1.2504293048415349E-5} {"x" 9.000000283122063, "y" 8.013054374075417E-6} {"x" 9.200000286102295, "y" 5.083865957875547E-6} {"x" 9.400000289082527, "y" 3.193354610174078E-6} {"x" 9.60000029206276, "y" 1.9858994691522355E-6} {"x" 9.800000295042992, "y" 1.2227127094295497E-6})}), "marks" ({"type" "line", "from" {"data" "c1b99cc0-775f-4e81-97f9-04e94244e911"}, "properties" {"enter" {"x" {"scale" "x", "field" "data.x"}, "y" {"scale" "y", "field" "data.y"}, "interpolate" {"value" "step-before"}, "fill" {"value" "steelblue"}, "fillOpacity" {"value" 0.4}, "stroke" {"value" "steelblue"}, "strokeWidth" {"value" 2}, "strokeOpacity" {"value" 1}}}} {"type" "line", "from" {"data" "6eda6a08-6b67-4f17-b24d-ad0d71ac1314"}, "properties" {"enter" {"x" {"scale" "x", "field" "data.x"}, "y" {"scale" "y", "field" "data.y"}, "stroke" {"value" "#FF29D2"}, "strokeWidth" {"value" 2}, "strokeOpacity" {"value" 1}}}})}}
;; <=

;; **
;;; Looks pretty good!
;; **
